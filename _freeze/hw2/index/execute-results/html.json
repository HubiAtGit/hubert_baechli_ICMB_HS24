{
  "hash": "ba47aee87638a439c2857e1ac54ab19f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 2: Economic Simulation\"\nauthor: \"Hubert Baechli\"\n---\n\n\n\n\n# My first attempt\n\nat an agent model with the information from the lesson\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSplitHalve <- function(nAgent,maxExchange,Money_mean=1000,Money_sd=300) {\n  df <- data.frame(ID=seq(1,nAgent),\n                   nE=0,\n                   Ms=rnorm(nAgent, mean = Money_mean, sd = Money_sd),\n                   MT=0,Me=0)\n  df$Me <- df$Ms\n  iE <- 1\n  while (iE <= maxExchange) {\n    df$MT <- df$Me\n    rdf <- sample(df[df$nE < iE,\"ID\"], size=2)\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"] <-\n      df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"]+1\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"Me\"] <-\n      sum(df[(df$ID == rdf[1] | df$ID == rdf[2]),\"MT\"])/2\n    if (NROW(df[df$nE < iE,\"ID\"]) < 2) {\n      iE <- iE+1\n      }\n  }\n  return(df)\n}\n```\n:::\n\n\n\n\nPresentation of the results\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitHalve(1000,30)\n\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       ID               nE           Ms               MT             Me      \n Min.   :   1.0   Min.   :30   Min.   : -35.7   Min.   :1011   Min.   :1011  \n 1st Qu.: 250.8   1st Qu.:30   1st Qu.: 807.4   1st Qu.:1011   1st Qu.:1011  \n Median : 500.5   Median :30   Median :1017.2   Median :1011   Median :1011  \n Mean   : 500.5   Mean   :30   Mean   :1011.1   Mean   :1011   Mean   :1011  \n 3rd Qu.: 750.2   3rd Qu.:30   3rd Qu.:1216.8   3rd Qu.:1011   3rd Qu.:1011  \n Max.   :1000.0   Max.   :30   Max.   :2005.2   Max.   :1011   Max.   :1011  \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-halve\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$ID,df$nE,main=\"Number of Changes\",\n     xlab=\"ID\",ylab=\"Number of Changes\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\n\n\nAfter looking at the code on <https://github.com/norvig/pytudes/blob/main/ipynb/Economics.ipynb#js-repo-pjax-container> there are some differences between my idea and the paper! These will now be adapted step by step.\n\n## First of all,\n\nthe restriction that everyone finds an change partner at the same time will be lifted. In addition, the number and order of changes will also be removed.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSplitHalve2 <- function(nAgent,maxExchange,Money_mean=1000,Money_sd=300) {\n  df <- data.frame(ID=seq(1,nAgent),\n                   nE=0,\n                   Ms=rnorm(nAgent, mean = Money_mean, sd = Money_sd),\n                   MT=0,Me=0)\n  df$Me <- df$Ms\n  iE <- 1\n  while (iE <= maxExchange) {\n    df$MT <- df$Me\n    rdf <- sample(df$ID, size=2)\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"] <-\n      df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"]+1\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"Me\"] <-\n      sum(df[(df$ID == rdf[1] | df$ID == rdf[2]),\"MT\"])/2\n    iE <- iE+1\n  }\n  return(df)\n}\n```\n:::\n\n\n\n\nPresentation of the results\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitHalve2(1000,15000)\n\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       ID               nE              Ms                MT      \n Min.   :   1.0   Min.   :15.00   Min.   : -30.55   Min.   :1011  \n 1st Qu.: 250.8   1st Qu.:26.75   1st Qu.: 813.34   1st Qu.:1011  \n Median : 500.5   Median :30.00   Median :1018.55   Median :1012  \n Mean   : 500.5   Mean   :30.00   Mean   :1011.52   Mean   :1012  \n 3rd Qu.: 750.2   3rd Qu.:34.00   3rd Qu.:1215.90   3rd Qu.:1012  \n Max.   :1000.0   Max.   :44.00   Max.   :1965.63   Max.   :1015  \n       Me      \n Min.   :1011  \n 1st Qu.:1011  \n Median :1012  \n Mean   :1012  \n 3rd Qu.:1012  \n Max.   :1015  \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-halve\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$ID,df$nE,main=\"Number of Changes\",\n     xlab=\"ID\",ylab=\"Number of Changes\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\n\n\n## The next step\n\nis to change from a half-split to a random-split. In the hope that this can reflect the results of the paper\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSplitRandom <- function(nAgent,maxExchange,Money_mean=1000,Money_sd=300) {\n  df <- data.frame(ID=seq(1,nAgent),\n                   nE=0,\n                   Ms=rnorm(nAgent, mean = Money_mean, sd = Money_sd),\n                   MT=0,Me=0)\n  df$Me <- df$Ms\n  iE <- 1\n  while (iE <= maxExchange) {\n    df$MT <- df$Me\n    rdf <- sample(df$ID, size=2)\n    rds <- sample(0:100, size=1)/100\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"] <-\n      df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"]+1\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"Me\"] <-\n      sum(df[(df$ID == rdf[1] | df$ID == rdf[2]),\"MT\"])*c(rds,1-rds)\n    iE <- iE+1\n  }\n  return(df)\n}\n```\n:::\n\n\n\n\n### I am very surprised!\n\nhere are the results for the random-split\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitRandom(1000,15000)\n\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       ID               nE           Ms                MT        \n Min.   :   1.0   Min.   :13   Min.   : -54.73   Min.   :   0.0  \n 1st Qu.: 250.8   1st Qu.:26   1st Qu.: 789.51   1st Qu.: 254.5  \n Median : 500.5   Median :30   Median :1000.84   Median : 628.2  \n Mean   : 500.5   Mean   :30   Mean   : 998.07   Mean   : 998.1  \n 3rd Qu.: 750.2   3rd Qu.:34   3rd Qu.:1206.97   3rd Qu.:1364.8  \n Max.   :1000.0   Max.   :48   Max.   :1944.15   Max.   :6632.3  \n       Me        \n Min.   :   0.0  \n 1st Qu.: 253.7  \n Median : 628.2  \n Mean   : 998.1  \n 3rd Qu.:1364.8  \n Max.   :6632.3  \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-random\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$ID,df$nE,main=\"Number of Changes\",\n     xlab=\"ID\",ylab=\"Number of Changes\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n\n\n# But why??????????\n\nthere seems to be no correlation to the number of meetings, to the money at the beginning or the ID (position in the matrix)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(df$nE,df$Me,main=\"Correlation to the Number of Changes\",\n     xlab=\"Number of Changes\",ylab=\"Money at the End\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$Ms,df$Me,main=\"Correlation to the Money at the Beginning\",\n     xlab=\"Money at the Beginning\",ylab=\"Money at the End\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$ID,df$Me,main=\"Correlation to the ID\",\n     xlab=\"ID\",ylab=\"Money at the End\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n:::\n\n\n\n\n## Idea from a proverb\n\ncan it be that it is harder to get money back once you have lost all the money *“money goes to money”*?\n\nas a first attempt, the random function is limited between 30% and 70%\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSplitRandom2 <- function(nAgent,maxExchange,Money_mean=1000,Money_sd=300) {\n  df <- data.frame(ID=seq(1,nAgent),\n                   nE=0,\n                   Ms=rnorm(nAgent, mean = Money_mean, sd = Money_sd),\n                   MT=0,Me=0)\n  df$Me <- df$Ms\n  iE <- 1\n  while (iE <= maxExchange) {\n    df$MT <- df$Me\n    rdf <- sample(df$ID, size=2)\n    rds <- sample(30:70, size=1)/100\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"] <-\n      df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"]+1\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"Me\"] <-\n      sum(df[(df$ID == rdf[1] | df$ID == rdf[2]),\"MT\"])*c(rds,1-rds)\n    iE <- iE+1\n  }\n  return(df)\n}\n```\n:::\n\n\n\n\nthe distribution seems to remain the same as the results here show,\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitRandom2(1000,15000)\n\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       ID               nE           Ms               MT        \n Min.   :   1.0   Min.   :15   Min.   :-251.9   Min.   : 287.5  \n 1st Qu.: 250.8   1st Qu.:26   1st Qu.: 789.6   1st Qu.: 734.8  \n Median : 500.5   Median :30   Median : 980.3   Median : 941.1  \n Mean   : 500.5   Mean   :30   Mean   : 984.0   Mean   : 984.0  \n 3rd Qu.: 750.2   3rd Qu.:34   3rd Qu.:1192.8   3rd Qu.:1180.4  \n Max.   :1000.0   Max.   :51   Max.   :1974.1   Max.   :2389.9  \n       Me        \n Min.   : 287.5  \n 1st Qu.: 734.8  \n Median : 941.1  \n Mean   : 984.0  \n 3rd Qu.:1180.4  \n Max.   :2389.9  \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-random (30%-70%)\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\nOn closer inspection, however, this does not help to understand the problem.\n\n## Back to a more restrictive Simulation\n\nThat's why I'm going back to my more restrictive Simulation where everyone has to have a meeting first so that someone can have a second meeting. This should help to understand how the timing of the meetings could have an influence...\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSplitRandomR <- function(nAgent,maxExchange,Money_mean=1000,Money_sd=300) {\n  df <- data.frame(ID=seq(1,nAgent),\n                   nE=0,\n                   Ms=rnorm(nAgent, mean = Money_mean, sd = Money_sd),\n                   MT=0,Me=0)\n  df$Me <- df$Ms\n  iE <- 1\n  while (iE <= maxExchange) {\n    df$MT <- df$Me\n    rdf <- sample(df[df$nE < iE,\"ID\"], size=2)\n    rds <- sample(0:100, size=1)/100\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"] <-\n      df[(df$ID == rdf[1] | df$ID == rdf[2]),\"nE\"]+1\n    df[(df$ID == rdf[1] | df$ID == rdf[2]),\"Me\"] <-\n      sum(df[(df$ID == rdf[1] | df$ID == rdf[2]),\"MT\"])*c(rds,1-rds)\n    if (NROW(df[df$nE < iE,\"ID\"]) < 2) {\n      iE <- iE+1\n    }\n  }\n  return(df)\n}\n```\n:::\n\n\n\n\nTime does not seem to have any effect either\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitRandomR(1000,30)\n\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       ID               nE           Ms               MT        \n Min.   :   1.0   Min.   :30   Min.   : 140.0   Min.   :   0.0  \n 1st Qu.: 250.8   1st Qu.:30   1st Qu.: 791.3   1st Qu.: 317.1  \n Median : 500.5   Median :30   Median : 996.9   Median : 671.4  \n Mean   : 500.5   Mean   :30   Mean   : 998.8   Mean   : 998.8  \n 3rd Qu.: 750.2   3rd Qu.:30   3rd Qu.:1197.3   3rd Qu.:1376.1  \n Max.   :1000.0   Max.   :30   Max.   :2109.9   Max.   :5644.8  \n       Me        \n Min.   :   0.0  \n 1st Qu.: 318.0  \n Median : 671.9  \n Mean   : 998.8  \n 3rd Qu.:1376.1  \n Max.   :5644.8  \n```\n\n\n:::\n\n```{.r .cell-code}\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-random Restricted\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(df$ID,df$nE,main=\"Number of Changes\",\n     xlab=\"ID\",ylab=\"Number of Changes\",\n     col=rgb(1,0,0,0.2))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n\n\n\n**But still why???**\n\nI think I need a simulation where I can save the money history!\n\n## Simple Timehistory\n\n### After the first change for all Agents\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitRandomR(1000,1)\n\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-random Restricted\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n### After the second change for all Agents\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- SplitRandomR(1000,2)\n\nhist(df$Ms, xlab=\"Money\",main=\"Histogram for split-random Restricted\",\n     col=rgb(0,0,1,0.2),\n     xlim=c(0,max(c(df$Me,df$Ms)))*1.1,ylim=c(0,nrow(df)/2))\nhist(df$Me, col=rgb(0,1,0,0.2),\n     add=TRUE)\nlegend('topright', c('Money befor', 'Money after'),\n       fill=c(rgb(0,0,1,0.5), rgb(0,1,0,0.2)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}